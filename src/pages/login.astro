---
// src/pages/login.astro
import { SignIn } from '../components/SignIn';
---

<html lang="es">
  <head>
    <title>Iniciar Sesión</title>
  </head>
  <body>
    <h1>Iniciar Sesión</h1>
    <SignIn client:load />
  </body>
</html>

---
// src/pages/admin.astro
import { getAuth, onAuthStateChanged } from 'firebase/auth';
import { getFirestore, doc, getDoc } from 'firebase/firestore';
import { app } from '../firebase';

const auth = getAuth(app);
const db = getFirestore(app);

let isAdmin = false;
let user = null;

if (Astro.request.method === 'GET') {
  const sessionPromise = new Promise((resolve) => {
    onAuthStateChanged(auth, async (firebaseUser) => {
      if (firebaseUser) {
        user = firebaseUser;
        const userDoc = await getDoc(doc(db, 'users', firebaseUser.uid));
        isAdmin = userDoc.exists() && userDoc.data().role === 'admin';
      }
      resolve();
    });
  });

  await sessionPromise;
}

if (!isAdmin) {
  return Astro.redirect('/acceso-denegado');
}
---

<html lang="es">
  <head>
    <title>Panel de Administración</title>
  </head>
  <body>
    <h1>Bienvenido al Panel de Administración</h1>
    <!-- Contenido del panel de administración -->
  </body>
</html>